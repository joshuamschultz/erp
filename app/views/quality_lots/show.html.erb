<div class="row-fluid">
  <% if  user_signed_in? &&  !current_user.is_customer? %>
    <div class="span3 well item_detail_view">
          <%= render :partial => 'po_headers/po_header_info' %>       
    </div>
  <%  end %>

  <div class="span7">
    <div class="row-fluid">
        <div class="row-fluid">
            <h4 class="span3 left">Lot Info</h4>
            <span class="span9 right">
              <% if can? :edit, QualityLot %>
                <%= link_to "Checklist", checklist_path(@quality_lot.checklist), :class => "btn btn-small" if @quality_lot.checklist %>
                <%= link_to "New PSW", new_ppap_path(:quality_lot_id => @quality_lot.id), :class => "btn btn-small" unless @quality_lot.ppap %>                
                <%= link_to "PSW", ppap_path(@quality_lot.ppap), :class => "btn btn-small" if @quality_lot.ppap %>
               
                  <%= link_to "Edit", edit_quality_lot_path(@quality_lot), :class => "btn btn-small" %>  
                <% end %>   
                <%= link_to "Back", quality_lots_path, :class =>"btn btn-small" %>
            </span>
        </div>

        <table class="table table-striped table-bordered">
          <tbody>
          <tr>
            <td>Control No:</td>
            <td><%= @quality_lot.lot_control_no %></td>
          </tr>

          <tr>
            <td>PO: </td>
            <% if can? :view, PoHeader %>
              <td><%= link_to(@quality_lot.po_header.po_identifier, po_header_path(@quality_lot.po_header)) %></td>
            <% else %>
               <td><%= @quality_lot.po_header.po_identifier %></td>
            <% end%> 
          </tr>

          <tr>
            <td>Part No:</td>
            <td><%= link_to(@quality_lot.po_line.item_alt_name.item_alt_identifier, item_path(@quality_lot.item_revision.item, revision_id: @quality_lot.item_revision_id)) if @quality_lot.item_revision %></td>
          </tr>

          <tr>
            <td>Revision:</td>
            <td><%= link_to(@quality_lot.item_revision.item_revision_name, item_path(@quality_lot.item_revision.item, revision_id: @quality_lot.item_revision_id)) if @quality_lot.item_revision %></td>
          </tr>

          <tr>
            <td>Quantity:</td>
            <td><%= @quality_lot.lot_quantity %></td>
          </tr>

          <tr>
            <td>Quantity On Hand:</td>
            <td><%= @quality_lot.quantity_on_hand %></td>
          </tr>

          <tr>
            <td>Inspection Level:</td>
            <td><%= link_to(@quality_lot.inspection_level.type_name, @quality_lot.inspection_level) if @quality_lot.inspection_level %></td>
          </tr>

          <tr>
            <td>Inspection Method:</td>
            <td><%= link_to(@quality_lot.inspection_method.type_name, @quality_lot.inspection_method) if @quality_lot.inspection_method %></td>
          </tr>

          <tr>
            <td>Inspection Type:</td>
            <td><%= link_to(@quality_lot.inspection_type.type_name, @quality_lot.inspection_type) if @quality_lot.inspection_type %></td>
          </tr>

          <tr>
            <td>AQL No:</td>
            <td><%= @quality_lot.lot_aql_no %></td>
          </tr>

          <tr>
            <td>FAI:</td>
            <td><%= @quality_lot.fai %></td>
          </tr>

          <tr>
            <td>Inspector:</td>
            <td><%= @quality_lot.lot_inspector.name if @quality_lot.lot_inspector %></td>
          </tr>

          <tr>
            <td>Process Flow:</td>
            <td><%= link_to @quality_lot.process_flow.process_name, @quality_lot.process_flow.attachment.attachment.url(:original), :target => "_blank" if @quality_lot.process_flow && @quality_lot.process_flow.attachment.present? %></td>
          </tr>

          <tr>
            <td>FMEA:</td>
            <td><%= link_to @quality_lot.fmea_type.fmea_name, @quality_lot.fmea_type.attachment.attachment.url(:original), :target => "_blank" if @quality_lot.fmea_type && @quality_lot.fmea_type.attachment.present? %></td>
          </tr>

          <tr>
            <td>Control Plan:</td>
            <td><%= link_to @quality_lot.control_plan.plan_name, @quality_lot.control_plan.attachment.attachment.url(:original), :target => "_blank" if @quality_lot.control_plan && @quality_lot.control_plan.attachment.present? %></td>
          </tr>

          <tr>
            <td>Run At Rate:</td>
            <td><%= link_to @quality_lot.run_at_rate.run_at_rate_name, @quality_lot.run_at_rate.attachment.attachment.url(:original), :target => "_blank" if @quality_lot.run_at_rate && @quality_lot.run_at_rate.attachment.present? %></td>
          </tr>
        
          <tr>
            <td>Finalized At:</td>
            <td><%= @quality_lot.lot_finalized_at.to_date if @quality_lot.lot_finalized_at.present? %></td>
          </tr>

          <tr>
            <td>Notes:</td>
            <td><%= @quality_lot.lot_notes %></td>
          </tr>

          <!-- <tr>
            <td>Active:</td>
            <td><%= @quality_lot.lot_active %></td>
          </tr> -->

          <tr>
            <td>Created At:</td>
            <td><%= @quality_lot.created_at.to_date %></td>
          </tr>

          </tbody>
        </table>
    </div>
  </div>



  <div class="span2"> 
  <% if can? :edit, QualityLot %>
    <div class="row-fluid item_detail_classic_btn">
        <div class="span12 well">
            <a class="widget-stats" href="<%= quality_lot_materials_path(quality_lot_id: @quality_lot.id) %>" id="">
                <h5><strong>Material <br /> Elements</strong></h5>
                <!-- <span class="txt"><strong>Dimensional Analysis</strong></span> -->
                <div class="clearfix"></div>
            </a>
        </div>
    </div>


    <div class="row-fluid item_detail_classic_btn">
        <div class="span12 well">
            <a class="widget-stats" href="<%= quality_lot_dimensions_path(quality_lot_id: @quality_lot.id) %>" id="">
                <h5><strong>Dimensional <br /> Analysis</strong></h5>
                <!-- <span class="txt"><strong>Dimensional Analysis</strong></span> -->
                <div class="clearfix"></div>
            </a>
        </div>
    </div>

    <div class="row-fluid item_detail_classic_btn">
        <div class="span12 well">
            <a class="widget-stats" href="<%= new_quality_lot_gauge_path(quality_lot_id: @quality_lot.id) %>" id="">
                <h5><strong>Gage <br /> R&R</strong></h5>
                <!-- <span class="txt"><strong>Gage R&R</strong></span> -->
                <div class="clearfix"></div>
            </a>
        </div>
    </div>

    <div class="row-fluid item_detail_classic_btn">
        <div class="span12 well">
            <a class="widget-stats" href="<%= quality_lot_capabilities_path(quality_lot_id: @quality_lot.id) %>" id="">
                <h5><strong>Process <br /> Capability</strong></h5>
                <!-- <span class="txt"><strong>Process Capability</strong></span> -->
                <div class="clearfix"></div>
            </a>
        </div>
    </div>
       <% end %>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>


    <div class="row-fluid item_detail_classic_btn">
        <div class="span12 well">
            <a class="widget-stats" href="#" id="" onclick="material_report()">
                <h5><strong>Inspection <br />  Report</strong></h5>
                <!-- <span class="txt"><strong>Process Capability</strong></span> -->
                <div class="clearfix"></div>
            </a>
        </div>
    </div>


<!--     <div class="row-fluid item_detail_classic_btn">
        <div class="span12 well">
            <a class="widget-stats" href="<%#= edit_quality_lot_path(@quality_lot, lot_shelf: true) %>" id="">
                <strong>Shelf</strong>
                <div class="row-fluid">
                    <div class="span6">
                      No: <%#= @quality_lot.lot_shelf_number %>
                    </div>
                    <div class="span6">
                      Unit: <%#= @quality_lot.lot_shelf_unit %>
                    </div>
                </div>
                <div class="clearfix"></div>
            </a>
        </div>
    </div> -->
    
  </div>

</div>

<div class="separator bottom"></div> 

<!-- Attachments -->
<!-- Attachments -->
<div class="row-fluid">
    <div class="attachment-pulp ee-10">
        <%= render :partial => 'attachments/droppable_form_plup_less' %>
    </div>

    <div class="span8 ee-17">
        <%= render 'attachments/attachments_less' %>
    </div>
</div>


<%= render :partial => 'comments/comments', 
:locals => {:extras => {:link => populate_quality_lot_path(@quality_lot, type: "note")}} %>



<script type="text/javascript">
<% if can? :edit, QualityLot %>
function material_report() {
    var quality_iframe = $("#lot_material")[0];
    quality_iframe.contentWindow.focus();
    quality_iframe.contentWindow.print();
    <% if @quality_lot.ppap %>
       dimension_report();
    <% else %>
      alert("Please create psw for dimension_report");
      gage_report();
    <% end %>
}
function dimension_report() {
    var dimension_iframe = $("#lot_dimension")[0];
    dimension_iframe.contentWindow.focus();
    dimension_iframe.contentWindow.print();
    gage_report();
}
function gage_report() {
    var gage_iframe = $("#lot_gage")[0];
    gage_iframe.contentWindow.focus();
    gage_iframe.contentWindow.print();
    <% if @quality_lot.ppap %>
      psw_report();
    <% else %>
      alert("Please create psw report");
      csk_report();
    <% end %>
}
function psw_report() {
    var psw_iframe = $("#lot_psw")[0];
    psw_iframe.contentWindow.focus();
    psw_iframe.contentWindow.print();
    csk_report();

}
function csk_report() {
    var csk_iframe = $("#lot_csk")[0];
    csk_iframe.contentWindow.focus();
    csk_iframe.contentWindow.print();
    <% if @quality_lot.package %>
      package_report();
    <% else %>
      alert("Please create package report");
      control_plan_report();
    <% end %>
}
function package_report() {

    var package_iframe = $("#lot_package")[0];
    package_iframe.contentWindow.focus();
    package_iframe.contentWindow.print();
    control_plan_report();
  
  

}
function control_plan_report() {
  <% master_type = MasterType.where(:type_value => "control_plan") %>
  <% if @quality_lot.checklist.check_list_lines.find_by_master_type_id(master_type).present? %>
      <% if @quality_lot.control_plan && @quality_lot.control_plan.attachment.present? %>
        var url = "<%= @quality_lot.control_plan.attachment.attachment.url(:original) %>";
        var printWin = window.open(url,'','left=0,top=0,width=1000,height=500,toolbar=0,scrollbars=1,status =0');

        printControlplan(printWin);
      <% else %>
        alert("Please create control_plan ");
        process_flow_report();
      <% end %>
  <% else %>
    process_flow_report();
  <% end %>

}

function printControlplan(win_id){
  setTimeout(function(){
    try {
      win_id.focus();
      win_id.print();
    }
    catch(e) {
      window.print(false);
    }

     return false;

  }, 2000);
  setTimeout(function(){
      win_id.close();
  }, 4000);
  setTimeout(function(){
     process_flow_report();
  }, 4000);
 

}


function process_flow_report() {
  <% master_type = MasterType.where(:type_value => "process_flow_diagram") %>
  <% if @quality_lot.checklist.check_list_lines.find_by_master_type_id(master_type).present? %>
    <% if  @quality_lot.process_flow && @quality_lot.process_flow.attachment.present? %>
      var url = "<%= @quality_lot.process_flow.attachment.attachment.url(:original) %>";
      var printWin = window.open(url,'','left=0,top=0,width=1000,height=500,toolbar=0,scrollbars=1,status =0');
      printProcess(printWin);
    <% else %>
      alert("Please create process_flow ");
      fmea_report();
    <% end %>
  <% else %>
    fmea_report();
  <% end %>
 }
function printProcess(win_id){
  setTimeout(function(){
    try {
      win_id.focus();
      win_id.print();
    }
    catch(e) {
      window.print(false);
    }

    return false;

  }, 2000);
  setTimeout(function(){
      win_id.close();
  }, 4000);
  setTimeout(function(){
     fmea_report();
  }, 4000);

}

function fmea_report() {
  <% master_type = MasterType.where(:type_value => "pfmea") %>
  <% if @quality_lot.checklist.check_list_lines.find_by_master_type_id(master_type).present? %>
    <% if @quality_lot.fmea_type && @quality_lot.fmea_type.attachment.present? %>
      var url = "<%= @quality_lot.fmea_type.attachment.attachment.url(:original) %>";
       var printWin = window.open(url,'','left=0,top=0,width=1000,height=500,toolbar=0,scrollbars=1,status =0');
      printFmea(printWin);
    <% else %>
      alert("please create fmea");
      quality_docs_report
    <% end %>
  <% else %>
    quality_docs_report
  <% end %>
}
function printFmea(win_id){
  setTimeout(function(){
    try {
      win_id.focus();
      win_id.print();
    }
    catch(e) {
      window.print(false);
    }

    return false;

  }, 2000);
  setTimeout(function(){
      win_id.close();
  }, 4000);
  setTimeout(function(){
     quality_docs_report();
  }, 4000);

}

function quality_docs_report() {
  <% master_type = MasterType.where(:type_value => "qualified_laboratory_docs") %>
  <% if @quality_lot.checklist.check_list_lines.find_by_master_type_id(master_type).present? %>
    <% @quality_lot.attachments.where(:attachment_public => true).each do |lab_doc| %>
      <% if lab_doc.present? %>
        var url = "<%= lab_doc.attachment.url(:original) %>";
        var printWin = window.open(url,'','left=0,top=0,width=1000,height=500,toolbar=0,scrollbars=1,status =0');
        printLab(printWin);
      <% end %>
    <% end %> 
  <% end %>
}
function printLab(win_id){
  setTimeout(function(){
    try {
      win_id.focus();
      win_id.print();
    }
    catch(e) {
      window.print(false);
    }

    return false;

  }, 2000);
  setTimeout(function(){
      win_id.close();
  }, 4000);

}






<% end %>
</script>
<iframe src="<%= material_report_quality_lot_path(@quality_lot) %>" style="border:0;" id="lot_material" width="10" height= "10"></iframe>

<iframe src="<%= dimension_report_quality_lot_path(@quality_lot) %>" style="border:0;" id="lot_dimension" width="10" height= "10"></iframe>

<iframe src="<%= gage_report_quality_lot_path(@quality_lot) %>" style="border:0;" id="lot_gage" width="10" height= "10"></iframe>

<iframe src="<%= psw_report_quality_lot_path(@quality_lot) %>" style="border:0;" id="lot_psw" width="10" height= "10" ></iframe>

<iframe src="<%= csk_report_quality_lot_path(@quality_lot) %>" style="border:0;" id="lot_csk" width="10" height= "10"></iframe>


<iframe src="<%= package_report_quality_lot_path(@quality_lot) %>" style="border:0;" id="lot_package" width="10" height= "10"></iframe>

<style>

.ee-17{width: 61% !important;}
iframe {
    width: 0;
}

</style>


