  <!-- Wells -->
<div class="row-fluid">
    <h4 class="span3 left"><%= @organization.organization_type.type_name %><span></span></h4>
    <span class="span9 right">
        <% if can? :update, @organizations %>
        <%= link_to 'Edit', edit_organization_path(@organization), :class => "btn btn-small" %>
        <% end %>
        <%#= link_to 'Gauges', organization_gauges_path(@organization), :class => "btn btn-small" if @organization.organization_type.type_value == "support" %>
        <%= link_to 'Back to Organizations', organizations_path, :class => "btn btn-small" %>
    </span>
</div>

<div class="row-fluid">
    <div class="span3 well view_organization_details">
        <%= render :partial => 'organizations/organization_info', :locals => {:organization => @organization} %>
    </div>

    <div class="span9">
        <div class="row-fluid">
            <div class="span6 well">
                <a class="widget-stats" onclick="get_address('address');" id="alt_address_btn">
                    <span class="glyphicons pin_flag"><i></i></span>
                    <span class="txt">Alternate Addresses</span>
                    <div class="clearfix"></div>
                </a>
            </div>

            <div class="span6 well">
                <a class="widget-stats"  onclick="get_address('contact');" id="contacts_btn">
                    <span class="glyphicons adress_book"><i></i></span>
                    <span class="txt">Contacts</span>
                    <div class="clearfix"></div>
                </a>
            </div>
        </div>

        <div class="row-fluid">
            <div id="organization_table_data" class="span12 well">
                <div id="org_contact">
                    <%= render 'contacts/org_contacts' %>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- <div class="separator bottom"></div>  -->

<!-- Attachments -->
<div class="row-fluid">
    <div class="attachment-pulp">
        <%= render :partial => 'attachments/droppable_form_plup_less' %>
    </div>
    <div class="span8">
        <%= render 'attachments/attachments_less' %>
    </div>
</div>

<%= render :partial => 'items/items' %>

<%  if ["customer", "vendor"].include?(@organization.type_name) %>

    <%= render :partial => 'po_headers/po_list', locals: {
        all_path: organization_path(@organization),
        open_path: organization_path(@organization, :po_status => "open"),
        closed_path: organization_path(@organization, :po_status => "closed"),
        index_path: po_headers_path(:po_status => params[:po_status], :organization_id => @organization.id),
        new_path: new_po_header_path
        }
    %>

    <%= render :partial => 'so_headers/so_list', locals: {
        all_path: organization_path(@organization),
        open_path: organization_path(@organization, :so_status => "open"),
        closed_path: organization_path(@organization, :so_status => "closed"),
        index_path: so_headers_path(:so_status => params[:so_status], :organization_id => @organization.id),
        new_path: new_so_header_path
        }
    %>    

    <!-- Quotes -->
    <!-- <div class="widget">
        <div class="widget-head">
            <div class="row-fluid">
                <h4 class="span6 heading">Quotes</h4>
                <span class="span6 heading right">
                    <%#= link_to 'Customer', "#", :class => "btn btn-mini btn-success" %>
                    <%#= link_to 'Vendor', "#", :class => "btn btn-mini btn-success" %>
                </span>
            </div> 
        </div>
        <div class="widget-body" style="height:150px"></div>
    </div> -->

    <!-- if @organization.organization_type.type_value == "vendor" -->
<% end %>
<%= render :partial => 'quotes/quote_list' if @organization.type_name == "vendor"%>
<%= render :partial => 'customer_quotes/customer_quote_list' if @organization.type_name == "customer" %>



<div class="separator bottom"></div>

<% unless @organization.type_name == "customer"%>
    <h5>Processes : <span></span></h5>
    <div class="well"> 
        <div class="row-fluid">    
            <div class="span12">
                <%= form_tag(populate_organization_path(type: "process"), method: "post") do %>
                    <%= select_tag "processes[]", options_for_select(ProcessType.all.map {|process| [process.process_short_name, process.id]}, @organization.organization_processes.empty? ? [] : @organization.organization_processes.collect(&:process_type_id)), :multiple => true, :size => 5, :class => "multi_select_box" %>
                <% end %>
            </div>
        </div>
    </div>
<% end %>

<div class="separator bottom"></div>

<h5>Tags : <span></span></h5>
<div class="well"> 
    <div class="row-fluid">    
        <div class="span12">
            <%= form_tag(populate_organization_path(type: "tag"), method: "post") do %>
                <div class="input-append span11">
                    <input type="hidden" id="organization_tags" style="width: 100%;" name="tags" value="<%= @tags.collect(&:comment).join(",") %>" />
                    <!-- <input type="hidden" name="tags" id="organization_tag_list" value="" /> -->
                    <!-- <button class="btn btn-default" id="submit_org_tags" type="submit">Save</button> -->
                </div>
            <% end %>
        </div>
    </div>
</div>

<div class="separator bottom"></div>

<%= render :partial => 'comments/comments', 
:locals => {:extras => {:link => add_comment_organization_path(type: "note", id: @organization.id)}} %>


<script type="text/javascript">
    $(document).ready(function(){ 
        var length = $(".select2-choices li").map(function() { return $(this).text() }).get().length;
        $("#organization_tags").select2({tags:<%= Commodity.all.collect(&:commodity_identifier).to_s.html_safe %>});

        // $("#submit_org_tags").on("click", function(e){
        //   $("#organization_tag_list").val($("#organization_tags").select2("val"));
        // });
        $("#processes_").on("change",function search(e) {            
            set_process($("#processes_").val());
        });


        $(".select2-input").on("keydown",function search(e) {
            if(e.keyCode == 13 || e.keyCode == 8) {
                set_tag($(".select2-choices li").map(function() { return $(this).text() }).get());
            }
        });
        $("#organization_tags").on("change",function search(e) {
            if($(".select2-choices li").map(function() { return $(this).text() }).get().length > length) {
                set_tag($(".select2-choices li").map(function() { return $(this).text() }).get());
            }
        });
    });

    function set_tag(data){
        if($(".select2-choices li").map(function() { return $(this).text() }).get().length != length) {
            length = $(".select2-choices li").map(function() { return $(this).text() }).get().length;
            initialize_api_call({"url": "/common_actions/get_info", "type": "GET", "data_type": "json", "params": {"mode": "set_tag", "id": "<%= @organization.id%>", "value": data}}, "status_result", {});
        }
    }

    function status_result(response, callback_params, api_params){
        if(response["aaData"] ==  "fail"){
        }
 
    }

    function set_process(data){
            initialize_api_call({"url": "/common_actions/get_info", "type": "GET", "data_type": "json", "params": {"mode": "set_process", "id": "<%= @organization.id%>", "value": data}}, "status_result", {});
    }

    // function search(ele) {
    //     if(event.keyCode == 13) {
    //         alert(ele.value);        
    //     }
    // }

    function callback_for_contacts(response, callback_params, api_params){
        $("#organization_table_data").html(response);
    }

    function get_address(type){
        $('#org_contact').html("");
        var adress = '<div class="widget-body"><table id="table_report_contacts" class="dynamicTable table table-striped table-bordered table-condensed row-fluid"><thead><tr><th>Title</th><th>escription</th><th>City</th><th>Telephone</th><th>Email</th><th>Fax</th><th></th></tr></thead><tbody></tbody></table></div></div>'
        $('#org_contact').html(adress);

       
            data_table_report_contacts = $('#table_report_contacts').dataTable({
                "bAutoWidth": false,
                "bProcessing": true,
                "sAjaxSource": '/contacts?contact_type='+type+'&amp;object_id=<%= @organization.id %>',
                "aaSorting": [[0, "asc"]],
                "aoColumns": [ 
                            { "mData": "contact_title" },
                            {"mData": "contact_description"}, 
                            {"mData": "contact_city"},
                            { "mData": "contact_telephone" },
                            { "mData": "contact_email" },
                            { "mData": "contact_fax" },
                            { "mData": "links", "bSortable": false, "bSearchable": false }
                        ],
                "bFilter": true,
                "bLengthChange": true
        });

    }
</script>


